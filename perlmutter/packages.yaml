packages:
  all:
    require:
      - one_of:
        - +cuda cuda_arch=80
        - ~cuda
    providers:
      blas: [cray-libsci]
      mpi: [cray-mpich]
      libglx: [opengl]
      gl: [egl, glx]
  gcc:
    externals:
    - spec: gcc@12.2.0 languages:='c,c++,fortran'
      modules:
      - gcc/12.2.0
      extra_attributes:
        compilers:
          c: gcc
          cxx: g++
          fortran: gfortran
        flags: {}
    - spec: gcc@11.2.0 languages:='c,c++,fortran'
      modules:
      - gcc/11.2.0
      extra_attributes:
        compilers:
          c: gcc
          cxx: g++
          fortran: gfortran
        flags: {}
    - spec: gcc@10.3.0 languages:='c,c++,fortran'
      modules:
      - gcc/10.3.0
      extra_attributes:
        compilers:
          c: gcc
          cxx: g++
          fortran: gfortran
        flags: {}
    - spec: gcc@12.3-native languages:='c,c++,fortran'
      modules:
      - gcc-native/12.3
      extra_attributes:
        compilers:
          c: gcc
          cxx: g++
          fortran: gfortran
        flags: {}
    - spec: gcc@13.2.1-native languages:='c,c++,fortran'
      modules:
      - gcc-native/13.2
      extra_attributes:
        compilers:
          c: gcc
          cxx: g++
          fortran: gfortran
        flags: {}

  nvhpc:
    buildable: false
    externals:
    - spec: nvhpc@24.5-12.4 %gcc@7.5.0
      modules:
      - PrgEnv-nvidia
      - cuda/12.4
      - craype-x86-milan
      - libfabric
      extra_attributes:
        compilers:
          c: /opt/cray/pe/craype/default/bin/cc
          cxx: /opt/cray/pe/craype/default/bin/CC
          fortran: /opt/cray/pe/craype/default/bin/ftn
    - spec: nvhpc@23.9-12.2 %gcc@7.5.0
      modules:
      - PrgEnv-nvidia
      - cuda/12.2
      - craype-x86-milan
      - libfabric
      extra_attributes:
        compilers:
          c: /opt/cray/pe/craype/default/bin/cc
          cxx: /opt/cray/pe/craype/default/bin/CC
          fortran: /opt/cray/pe/craype/default/bin/ftn
    - spec: nvhpc@23.1-12.0 %gcc@7.5.0
      modules:
      - PrgEnv-nvidia
      - cuda/12.0
      - craype-x86-milan
      - libfabric
      extra_attributes:
        compilers:
          c: /opt/cray/pe/craype/default/bin/cc
          cxx: /opt/cray/pe/craype/default/bin/CC
          fortran: /opt/cray/pe/craype/default/bin/ftn
    - spec: nvhpc@24.5-11.7 %gcc@7.5.0
      modules:
      - PrgEnv-nvidia
      - cuda/11.7
      - craype-x86-milan
      - libfabric
      extra_attributes:
        compilers:
          c: /opt/cray/pe/craype/default/bin/cc
          cxx: /opt/cray/pe/craype/default/bin/CC
          fortran: /opt/cray/pe/craype/default/bin/ftn
  cuda:
    buildable: false
    externals:
    - spec: cuda@12.4.0
      prefix: /opt/nvidia/hpc_sdk/Linux_x86_64/24.5/cuda/12.4
      modules:
      - cuda/12.4
    - spec: cuda@12.2.0
      prefix: /opt/nvidia/hpc_sdk/Linux_x86_64/23.9/cuda/12.2
      modules:
      - cuda/12.2
    - spec: cuda@12.0.0
      prefix: /opt/nvidia/hpc_sdk/Linux_x86_64/23.1/cuda/12.0
      modules:
      - cuda/12.0
    - spec: cuda@11.7.0
      prefix: /opt/nvidia/hpc_sdk/Linux_x86_64/24.5/cuda/11.7
      modules:
      - cuda/11.7

  cray-libsci:
    buildable: false
    externals:
    - spec: cray-libsci@24.07.0
      modules:
      - cray-libsci/24.07.0
    - spec: cray-libsci@23.12.5
      modules:
      - cray-libsci/23.12.5

  cray-mpich:
    # cray-mpich externals need to define prefix
    buildable: false
    externals:
    - spec: cray-mpich@8.1.30 +cuda cuda_arch=80 %gcc
      prefix: /opt/cray/pe/mpich/8.1.30/ofi/gnu/12.3
      modules:
      - cray-mpich/8.1.30
    - spec: cray-mpich@8.1.30 +cuda cuda_arch=80 %nvhpc
      prefix: /opt/cray/pe/mpich/8.1.30/ofi/nvidia/23.3
      modules:
      - cray-mpich/8.1.30
  libfabric:
    buildable: false
    variants: fabrics=cxi,tcp,sockets,shm,udp,rxd,rxm
    externals:
    - spec: libfabric@1.20.1
      prefix: /opt/cray/libfabric/1.20.1
      modules:
      - libfabric/1.20.1

  # System preferences
  openssl:
    buildable: false
    externals:
    - spec: openssl@1.1.1-fips
      prefix: /usr
  openssh:
    buildable: false
    externals:
    - spec: openssh@8.4p1
      prefix: /usr
  egl:
    buildable: false
    externals:
    - spec: egl@1.5
      prefix: /usr
  opengl:
    buildable: false
    externals:
    - spec: opengl@4.5
      prefix: /usr
  slurm:
    buildable: false
    externals:
    - spec: slurm@24-11-5
      prefix: /usr
  paraview:
    variants: ~qt ^[virtuals=gl] egl
  visit:
    variants: ~gui ^[virtuals=gl] egl
